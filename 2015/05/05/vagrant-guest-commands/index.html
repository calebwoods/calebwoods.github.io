<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <title>Running Commands on Vagrant Guest from Host</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" />
    <meta content="linux,bash,ruby,scripting" name="keywords" />
    <link href="//brick.a.ssl.fastly.net/Noto+Sans:400,400i,700" rel="stylesheet" />
    <link href="/css/syntax.css" rel="stylesheet" />
    <link href="/css/main.css" rel="stylesheet" />
    <link href="/feed.xml" rel="alternate" type="application/atom+xml" />
  </head>
  <body>
    <div class="header">
      <div class="overlay">
        <div class="site">
          <h1 class="title">
            <a href="/">
              <div class="avatar"></div>
              Caleb Woods</a>
          </h1>
          <div class="extra">
            <a href="/feed.xml">feed</a>
            <a href="#contact">contact</a>
          </div>
        </div>
      </div>
    </div>
    <div class="site">

      <span class="back"><a href="/">Home</a> ></span>
<h2>
  Running Commands on Vagrant Guest from Host
</h2>

<p class="meta">
  05 May 2015
  
    <a class="article-tag" href="/tags/linux">linux</a>
  
    <a class="article-tag" href="/tags/bash">bash</a>
  
    <a class="article-tag" href="/tags/ruby">ruby</a>
  
    <a class="article-tag" href="/tags/scripting">scripting</a>
  
</p>

<div class="post">
  <p>Recently, I&#39;ve been working on converting several development environments to <a href="https://www.vagrantup.com/">Vagrant</a> VMs, in order to speedup setup time when bringing in new developers and making environment changes.</p>

<p>A few years ago I wrote a tool, <a href="https://github.com/calebwoods/shoestring">Shoestring</a>, to help make writing bootstrapping scripts for development environments easier.  I quickly discovered that what I really wanted was a full provisioning tool that could start with a near empty machine. Couple that experience with the fact that I&#39;ve been using <a href="http://www.ansible.com/home">Ansible</a> for the past couple of years and writing my own tool seemed like overkill.</p>

<h3>Potential Solution</h3>

<p>With Ansible and Vagrant it is pretty straightforward to create a development environment that can be built with the simple command <code>vagrant up</code>.  Additionally, the environment can more closely mirror production with the same OS and shared provisioning scripts.</p>

<p>One of my biggest issues with a Vagrant setup was that to run any commands, such as unit tests or a development server, one would have to ssh into the VM.  Then once in the VM all of my aliases and shortcuts are no more, and I would need to toggle back and forth between the VM and my local machine for things like git.</p>

<h3>vagrant ssh -c</h3>

<p>While looking at the <a href="https://docs.vagrantup.com/v2/cli/ssh.html">Vagrant documentation</a>, however, I found the <code>-c</code> option which can be passed to <code>vagrant ssh</code>.  With this, a command can be specified as a string and sent over ssh to the guest VM then executed with all output re-routed to the host machine&#39;s stdout and stderr.</p>

<p>This means to run the rspec test suite for a project I would just need the following:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ vagrant ssh -c &#39;cd /vagrant; bundle exec rspec&#39;
</code></pre></div>
<p>Even cooler is that if you have a debugger in your specs, such as <a href="http://pryrepl.org/">Pry</a>, you can still interact with the repl like you would if it were running on your local machine.</p>

<h3>More Awesome-Sauce</h3>

<p>Then I realized I have an alias that I use to run <code>bundle exec</code> commands by just using <code>b</code>.  For example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ b rspec
</code></pre></div>
<p>So I created <code>v</code> and <code>vb</code> shortcut functions. This allows me to just add one character to the above rspec command and it will run on the guest VM instead.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ vb rspec
</code></pre></div>
<p>All that is needed is adding the following functions to your <code>.bashrc</code>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># .bashrc</span>

<span class="c"># Execute commands on Vagrant remote</span>
vb<span class="o">()</span> <span class="o">{</span>
  <span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;cd /vagrant; bundle exec $@&quot;</span><span class="p">;</span>
  vagrant ssh -c <span class="s2">&quot;$CMD&quot;</span>
<span class="o">}</span>

v<span class="o">()</span> <span class="o">{</span>
  <span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;cd /vagrant; $@&quot;</span><span class="p">;</span>
  vagrant ssh -c <span class="s2">&quot;$CMD&quot;</span>
<span class="o">}</span>
</code></pre></div>
<p>With these functions I&#39;ve found working with Vagrant development environment to be so much more enjoyable and seamless.  Have other improvements to your own Vagrant workflow? Tweet at me <a href="https://twitter.com/calebwoods">@calebwoods</a>.</p>

</div>

<div class="related-posts">
  <h4>Related Posts</h4>

  <ul>
    
      <li>
        <a href="/2015/08/02/ssh-ansible-host/">
          <span class="article-title">SSH to Ansible host by hostname</span>
        </a>
      </li>
    
      <li>
        <a href="/2015/06/27/mixing-ansible-roles-tasks/">
          <span class="article-title">Mixing Ansible Roles and Tasks</span>
        </a>
      </li>
    
      <li>
        <a href="/2015/04/06/diy-time-capsule-raspberry-pi/">
          <span class="article-title">DIY Time Capsule with a Raspberry Pi</span>
        </a>
      </li>
    
  </ul>
</div>


      <div class="footer" id="contact">
        <p>
          &copy; 2013 - 2019 Caleb Woods. All Right Reserved.
        </p>
        <div class="contact">
          <p>
            <span>Caleb Woods</span><span>Software Craftsman</span><span>caleb@calebwoods.com</span>
          </p>
        </div>
        <div class="contact">
          <p>
            <a href="https://github.com/calebwoods">github.com/calebwoods</a>
            <a href="https://medium.com/@calebwoods">medium.com/@calebwoods</a>
            <a href="https://twitter.com/calebwoods">twitter.com/calebwoods</a>
            <a href="https://www.linkedin.com/in/calebwoods">linkedin.com/in/calebwoods</a>
          </p>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-49249459-1', 'calebwoods.com');ga('send', 'pageview');
    </script>
  </body>
</html>
