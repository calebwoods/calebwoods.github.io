<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <title>Advanced Arel Cheat Sheet</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" />
    <meta content="rails,reference" name="keywords" />
    <link href="//brick.a.ssl.fastly.net/Noto+Sans:400,400i,700" rel="stylesheet" />
    <link href="/css/syntax.css" rel="stylesheet" />
    <link href="/css/main.css" rel="stylesheet" />
    <link href="/feed.xml" rel="alternate" type="application/atom+xml" />
  </head>
  <body>
    <div class="header">
      <div class="overlay">
        <div class="site">
          <h1 class="title">
            <a href="/">
              <div class="avatar"></div>
              Caleb Woods</a>
          </h1>
          <div class="extra">
            <a href="/feed.xml">feed</a>
            <a href="#contact">contact</a>
          </div>
        </div>
      </div>
    </div>
    <div class="site">

      <span class="back"><a href="/">Home</a> ></span>
<h2>
  Advanced Arel Cheat Sheet
</h2>

<p class="meta">
  11 Aug 2015
  
    <a class="article-tag" href="/tags/rails">rails</a>
  
    <a class="article-tag" href="/tags/reference">reference</a>
  
</p>

<div class="post">
  <p>After seeing <a href="https://twitter.com/camertron">@camertron</a>&#39;s talk on Advance Arel from Rails Conf 2014 (<a href="http://www.slideshare.net/camerondutro/advanced-arel-when-activerecord-just-isnt-enough">slides</a>) I&#39;ve wanted a simple reference for the most common Arel comparators that I forget to use instead of string interpolation.</p>

<p>This post was motivated by a recent bug I found in one of my applications where using string interpolation with joined relations caused an ambiguous column SQL error. While this post is intended to serve as a personal reference, it may be useful to others as well.</p>

<p>Also check out <a href="http://www.scuttle.io/">scuttle.io</a> as a further resource to translate SQL to Arel.</p>

<p><strong>Note</strong> Arel is considered an internal API for ActiveRecord and can change between major Rails versions. </p>

<h3>Setup</h3>

<p>My examples assume a Rails 4.2 application and a single <code>Post</code> model with 2 attributes <code>title</code> and <code>published_date</code>, <a href="https://gist.github.com/calebwoods/af61c6af057067f55a27">gist</a>.</p>

<p>Note that pulling in the <a href="https://github.com/camertron/arel-helpers">arel-helpers</a> gem can eliminate the need to keep calling <code>arel_table</code> all over the place and adds some potentially useful join helpers.</p>

<h3>Equality</h3>

<p>Greater than</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
  <span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:published_date</span><span class="o">].</span><span class="n">gt</span><span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;published_date &gt; ?&#39;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</code></pre></div>
<p>Less than</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
  <span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:published_date</span><span class="o">].</span><span class="n">lt</span><span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;published_date &lt; ?&#39;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</code></pre></div>
<p>Greater than or equal</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
  <span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:published_date</span><span class="o">].</span><span class="n">gteq</span><span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;published_date &gt;= ?&#39;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</code></pre></div>
<p>Less than or equal</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
  <span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:published_date</span><span class="o">].</span><span class="n">lteq</span><span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;published_date &lt;= ?&#39;</span><span class="p">,</span> <span class="no">Date</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</code></pre></div>
<p>Not equal</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:title</span><span class="o">].</span><span class="n">not_eq</span><span class="p">(</span><span class="s1">&#39;Sample Post&#39;</span><span class="p">))</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;title != ?&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Post&#39;</span><span class="p">)</span>
</code></pre></div>
<h3>Matching / (I)LIKE</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:title</span><span class="o">].</span><span class="n">matches</span><span class="p">(</span><span class="s1">&#39;%sample%&#39;</span><span class="p">))</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;title ILIKE ?&#39;</span><span class="p">,</span> <span class="s1">&#39;%sample%&#39;</span><span class="p">)</span>
</code></pre></div>
<h3>Ordering</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="no">Post</span><span class="o">.</span><span class="n">arel_table</span><span class="o">[</span><span class="ss">:publish_date</span><span class="o">].</span><span class="n">desc</span><span class="p">)</span>

<span class="c1"># instead of</span>

<span class="no">Post</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;publish_date DESC&#39;</span><span class="p">)</span>
</code></pre></div>
<p>If you are looking for even more flexibility and control than what ActiveRecord provides, I would highly recommend the <a href="https://github.com/jeremyevans/sequel">sequel</a> gem.</p>

<p>Have other tricks you use with ActiveRecord? Tweet at me <a href="https://twitter.com/calebwoods">@calebwoods</a>.</p>

</div>

<div class="related-posts">
  <h4>Related Posts</h4>

  <ul>
    
      <li>
        <a href="/2019/02/02/intermittent-offline-system-tests/">
          <span class="article-title">Intermittent Offline System Tests</span>
        </a>
      </li>
    
      <li>
        <a href="/2017/03/08/testing-apis-json-schema/">
          <span class="article-title">Testing Rails APIs with JSON Schema</span>
        </a>
      </li>
    
      <li>
        <a href="/2015/11/01/testing-react-components-rails/">
          <span class="article-title">Testing React Components in Rails</span>
        </a>
      </li>
    
  </ul>
</div>


      <div class="footer" id="contact">
        <p>
          &copy; 2013 - 2019 Caleb Woods. All Right Reserved.
        </p>
        <div class="contact">
          <p>
            <span>Caleb Woods</span><span>Software Craftsman</span><span>caleb@calebwoods.com</span>
          </p>
        </div>
        <div class="contact">
          <p>
            <a href="https://github.com/calebwoods">github.com/calebwoods</a>
            <a href="https://medium.com/@calebwoods">medium.com/@calebwoods</a>
            <a href="https://twitter.com/calebwoods">twitter.com/calebwoods</a>
            <a href="https://www.linkedin.com/in/calebwoods">linkedin.com/in/calebwoods</a>
          </p>
        </div>
      </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-49249459-1', 'calebwoods.com');ga('send', 'pageview');
    </script>
  </body>
</html>
